"use strict";(self.webpackChunk_app_client=self.webpackChunk_app_client||[]).push([[283],{283:function(e,t,n){n.r(t),n.d(t,{default:function(){return F}});var r=n(294),a=n(977),c=n(12),o=n(477),i=n(762),l=n(433),s={position:new o.Vector3(0,0,20)};let u,p;!function(e){e[e.up=0]="up",e[e.down=1]="down",e[e.left=2]="left",e[e.right=3]="right"}(u||(u={})),function(e){e[e.none=0]="none",e[e.up=1]="up",e[e.down=2]="down",e[e.left=3]="left",e[e.right=4]="right"}(p||(p={}));var m={direction:p.none,position:new o.Vector3(0,0,0),velocity:new o.Vector3(0,0,0),speed:.1},f=50,d=50,w=3,h=3;function g(e){let{children:t}=e;const[n,a]=r.useMemo((()=>[new o.Vector3(-.5*f,-.5*d+.5*h,0),new o.Vector3(.5*f,.5*d,0)]),[]);return(0,i.x)((e=>{let{camera:t}=e;m.position.add(m.velocity.multiplyScalar(m.speed)).clamp(n,a),t.position.copy(m.position),t.position.z=s.position.z,t.rotation.set(0,0,0)})),r.createElement(r.Fragment,null,r.createElement(l.c,{makeDefault:!0,position:s.position},r.createElement("group",{"position-z":-1*s.position.z},t)))}var E=n(769);function k(e){const t=e.replace(/^\/+/,"");return"".concat("./").concat(t)}function y(){const e=(0,E.m)(k("/assets/map.png"));return r.useMemo((()=>{e.wrapS=o.RepeatWrapping,e.wrapT=o.RepeatWrapping,e.repeat=new o.Vector2(.5*f,.5*d)}),[e]),r.createElement("group",null,r.createElement("mesh",null,r.createElement("planeBufferGeometry",{args:[f,d]}),r.createElement("meshBasicMaterial",{depthWrite:!1,map:e})))}function v(e,t,n){const a=r.useRef(t);r.useMemo((()=>{a.current=t}),[t]);const c=r.useRef(n);r.useMemo((()=>{c.current=n}),[n]),r.useEffect((()=>(window.addEventListener(e,a.current,c.current),()=>{window.removeEventListener(e,a.current,c.current)})),[e])}function b(){const e=function(){const[e,t]=r.useState([]);function n(e){let t;switch(e.toLocaleLowerCase()){case"w":case"arrowup":t=u.up;break;case"s":case"arrowdown":t=u.down;break;case"a":case"arrowleft":t=u.left;break;case"d":case"arrowright":t=u.right}return t}return v("keydown",(e=>{const r=n(e.key);void 0!==r&&t((e=>e.includes(r)?e:[...e,r]))})),v("keyup",(e=>{const r=n(e.key);void 0!==r&&t((e=>e.filter((e=>e!==r))))})),e}(),{canvas:t,ctx:n,texture:a}=r.useMemo((()=>{const e=document.createElement("canvas"),t=e.getContext("2d"),n=new o.Texture(e);return n.minFilter=o.NearestFilter,n.magFilter=o.NearestFilter,{canvas:e,ctx:t,texture:n}}),[]);return r.useEffect((()=>{const e=new Image;e.onload=()=>l(),e.src=k("/assets/player.png");let r,c=0,o=0,i=0;function l(){r=requestAnimationFrame(l);const s=e.width/4,u=e.height/4;t.width=s,t.height=u;const f=Date.now();if(!(f-i<125)){switch(i=f,m.direction){case p.none:o=0;break;case p.up:c=3;break;case p.down:c=0;break;case p.left:c=1;break;case p.right:c=2}n.clearRect(0,0,s,u),n.drawImage(e,s*o,u*c,s,u,0,0,s,u),++o>3&&(o=0),a.needsUpdate=!0}}return()=>cancelAnimationFrame(r)}),[t,n,a]),(0,i.x)((()=>{let t=0;for(let n=0,r=e.length;n<r;n++)switch(e[n]){case u.up:t=p.up;break;case u.down:t=p.down;break;case u.left:t=p.left;break;case u.right:t=p.right}switch(t){case p.none:m.velocity.set(0,0,0);break;case p.up:m.velocity.y=1;break;case p.down:m.velocity.y=-1;break;case p.left:m.velocity.x=-1;break;case p.right:m.velocity.x=1;break;default:m.velocity.set(0,0,0)}m.direction=t})),r.createElement("group",null,r.createElement("mesh",null,r.createElement("planeBufferGeometry",{args:[w,h]}),r.createElement("meshBasicMaterial",{depthWrite:!1,transparent:!0,map:a})))}var x=3,M=3;function z(){const e=r.createRef(),t=r.createRef(),{size:n,camera:a}=(0,i.w)();return r.useEffect((()=>{const t=e.current,n=a,r=o.MathUtils.degToRad(n.fov),c=2*Math.tan(r/2)*s.position.z,i=c*n.aspect;t.position.set(-.5*i+.5*x+.5,-.5*c+.5*M+.5,t.position.z)}),[n,a]),(0,i.x)((()=>{t.current.position.copy(m.position).multiplyScalar(x/f)})),r.createElement("group",{ref:e},r.createElement("mesh",null,r.createElement("planeBufferGeometry",{args:[x,M]}),r.createElement("meshBasicMaterial",{color:"black",depthWrite:!1})),r.createElement("mesh",{ref:t},r.createElement("planeBufferGeometry",{args:[w*(x/f),h*(M/d)]}),r.createElement("meshBasicMaterial",{color:"crimson",depthWrite:!1})))}function B(){return r.createElement(a.Xz,{flat:!0,linear:!0,dpr:1},r.createElement(r.Suspense,{fallback:r.createElement(c.x,null,"Loading...")},r.createElement(y,null),r.createElement(g,null,r.createElement(b,null),r.createElement(z,null))))}function F(){return r.createElement(r.Fragment,null,r.createElement(B,null))}}}]);
//# sourceMappingURL=283.6a76a908.chunk.js.map