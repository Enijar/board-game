{"version":3,"file":"649.c43d81a5.chunk.js","mappings":"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","sources":["webpack://@app/client/./src/game/config/camera.ts","webpack://@app/client/./src/game/components/camera/camera.tsx","webpack://@app/client/./src/game/hooks/use-listener.ts","webpack://@app/client/./src/game/components/player/player.tsx","webpack://@app/client/./src/game/hooks/use-keys.ts","webpack://@app/client/./src/game/utils.ts","webpack://@app/client/./src/game/game.tsx","webpack://@app/client/./src/pages/home/home.tsx"],"sourcesContent":["import * as THREE from \"three\";\n\nconst cameraConfig = {\n  position: new THREE.Vector3(0, 5, 10),\n};\n\nexport default cameraConfig;\n","import React from \"react\";\nimport { OrbitControls, PerspectiveCamera } from \"@react-three/drei\";\nimport cameraConfig from \"@/game/config/camera\";\n\ntype Props = {\n  children?: React.ReactNode;\n};\n\nexport default function Camera({ children }: Props) {\n  return (\n    <>\n      <PerspectiveCamera makeDefault position={cameraConfig.position}>\n        <group position-z={cameraConfig.position.z * -1}>{children}</group>\n      </PerspectiveCamera>\n      <OrbitControls makeDefault />\n    </>\n  );\n}\n","import React from \"react\";\n\nexport default function useListener<K extends keyof WindowEventMap>(\n  type: K,\n  listener: (this: Window, ev: WindowEventMap[K]) => any,\n  options?: boolean | AddEventListenerOptions\n) {\n  const listenerRef = React.useRef(listener);\n  React.useMemo(() => {\n    listenerRef.current = listener;\n  }, [listener]);\n\n  const optionsRef = React.useRef(options);\n  React.useMemo(() => {\n    optionsRef.current = options;\n  }, [options]);\n\n  React.useEffect(() => {\n    window.addEventListener(type, listenerRef.current, optionsRef.current);\n    return () => {\n      window.removeEventListener(type, listenerRef.current, optionsRef.current);\n    };\n  }, [type]);\n}\n","import React from \"react\";\nimport * as THREE from \"three\";\nimport { MeshBVH, acceleratedRaycast } from \"three-mesh-bvh\";\nimport { useFrame } from \"@react-three/fiber\";\nimport useKeys from \"@/game/hooks/use-keys\";\nimport { updateVelocity } from \"@/game/utils\";\n\nTHREE.Mesh.prototype.raycast = acceleratedRaycast;\n\nlet tempBox = new THREE.Box3();\n\nconst rayVector = new THREE.Vector3(0, -1, 0);\n\ntype Props = {\n  speed?: number;\n};\n\nexport default function Player({ speed = 0.05 }: Props) {\n  const velocityRef = React.useRef(new THREE.Vector3());\n\n  const keys = useKeys([\"w\", \"s\", \"a\", \"d\", \" \"]);\n\n  const playerRef = React.useRef<THREE.Mesh>();\n  const floorRef = React.useRef<THREE.Mesh>();\n\n  React.useEffect(() => {\n    const player = playerRef.current;\n    const floor = floorRef.current;\n    player.geometry.boundsTree = new MeshBVH(player.geometry);\n    floor.geometry.boundsTree = new MeshBVH(floor.geometry);\n  }, []);\n\n  useFrame(({ raycaster }) => {\n    raycaster.firstHitOnly = true;\n\n    const player = playerRef.current;\n    const floor = floorRef.current;\n    const velocity = velocityRef.current;\n\n    updateVelocity(keys, velocity);\n\n    player.position.add(velocity.multiplyScalar(speed));\n\n    floor.geometry.boundsTree.shapecast({\n      intersectsBounds(box) {\n        tempBox = tempBox.makeEmpty();\n        return box.intersectsBox(tempBox);\n      },\n      intersectsTriangle() {\n        //\n      },\n    });\n  });\n\n  return (\n    <group>\n      <mesh\n        ref={playerRef}\n        position={[0, 0.5, 0]}\n        userData={{ name: \"player\" }}\n      >\n        <boxBufferGeometry />\n        <meshBasicMaterial color=\"crimson\" />\n      </mesh>\n\n      <mesh\n        ref={floorRef}\n        userData={{ name: \"floor\" }}\n        rotation={[THREE.MathUtils.degToRad(-90), 0, 0]}\n      >\n        <planeBufferGeometry args={[3, 3]} />\n        <meshBasicMaterial color=\"grey\" side={THREE.DoubleSide} />\n      </mesh>\n    </group>\n  );\n}\n","import React from \"react\";\nimport useListener from \"@/game/hooks/use-listener\";\n\nexport default function useKeys(allowedKeys: string[]): string[] {\n  const keysRef = React.useRef<string[]>([]);\n\n  useListener(\"keydown\", (event) => {\n    const keys = keysRef.current;\n    const key = event.key.toLowerCase();\n    if (!allowedKeys.includes(key) || keys.includes(key)) return;\n    keys.push(key);\n  });\n\n  useListener(\"keyup\", (event) => {\n    const keys = keysRef.current;\n    const key = event.key.toLowerCase();\n    const index = keys.indexOf(key);\n    if (index === -1) return;\n    keys.splice(index, 1);\n  });\n\n  return keysRef.current;\n}\n","import * as THREE from \"three\";\n\nexport function updateVelocity(keys: string[], velocity: THREE.Vector3) {\n  velocity.set(0, 0, 0);\n  keys.forEach((key) => {\n    if (key === \"w\") velocity.z = -1;\n    if (key === \"s\") velocity.z = 1;\n    if (key === \"a\") velocity.x = -1;\n    if (key === \"d\") velocity.x = 1;\n  });\n}\n","import React from \"react\";\nimport { Canvas } from \"@react-three/fiber\";\nimport { Text } from \"@react-three/drei\";\nimport Camera from \"@/game/components/camera/camera\";\nimport Player from \"@/game/components/player/player\";\n\nexport default function Game() {\n  return (\n    <Canvas flat linear dpr={1}>\n      <React.Suspense fallback={<Text>Loading...</Text>}>\n        <Camera />\n        <Player />\n      </React.Suspense>\n    </Canvas>\n  );\n}\n","import React from \"react\";\nimport Game from \"@/game/game\";\n\nexport default function Home() {\n  return (\n    <>\n      <Game />\n    </>\n  );\n}\n"],"names":["position","THREE","Camera","children","PerspectiveCamera","makeDefault","cameraConfig","OrbitControls","useListener","type","listener","options","listenerRef","React","current","optionsRef","window","addEventListener","removeEventListener","acceleratedRaycast","tempBox","Player","speed","velocityRef","keys","allowedKeys","keysRef","event","key","toLowerCase","includes","push","index","indexOf","splice","useKeys","playerRef","floorRef","player","floor","geometry","boundsTree","MeshBVH","useFrame","raycaster","firstHitOnly","velocity","set","forEach","z","x","updateVelocity","add","multiplyScalar","shapecast","intersectsBounds","box","makeEmpty","intersectsBox","intersectsTriangle","ref","userData","name","color","rotation","args","side","Game","flat","linear","dpr","fallback","Text","Home"],"sourceRoot":""}