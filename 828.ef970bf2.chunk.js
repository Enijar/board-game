"use strict";(self.webpackChunk_app_client=self.webpackChunk_app_client||[]).push([[828],{828:function(e,t,n){n.r(t),n.d(t,{default:function(){return F}});var r=n(294),a=n(977),c=n(12),o=n(477),l=n(762),i=n(433),s={position:new o.Vector3(0,0,20)};let u;!function(e){e[e.none=0]="none",e[e.up=1]="up",e[e.down=2]="down",e[e.left=3]="left",e[e.right=4]="right"}(u||(u={}));var p={direction:u.none,position:new o.Vector3(0,0,0),velocity:new o.Vector3(0,0,0),speed:.1},m=50,f=50;function d(e){let{children:t}=e;const[n,a]=r.useMemo((()=>[new o.Vector3(-.5*m,-.5*f,0),new o.Vector3(.5*m,.5*f,0)]),[]);return(0,l.x)((e=>{let{camera:t}=e;p.position.add(p.velocity.multiplyScalar(p.speed)).clamp(n,a),t.position.copy(p.position),t.position.z=s.position.z,t.rotation.set(0,0,0)})),r.createElement(r.Fragment,null,r.createElement(i.c,{makeDefault:!0,position:s.position},r.createElement("group",{"position-z":-1*s.position.z},t)))}var w=n(769);function h(e){const t=e.replace(/^\/+/,"");return"".concat("./").concat(t)}function g(){const e=(0,w.m)(h("/assets/map.png"));return r.useMemo((()=>{e.wrapS=o.RepeatWrapping,e.wrapT=o.RepeatWrapping,e.repeat=new o.Vector2(.5*m,.5*f)}),[e]),r.createElement("group",null,r.createElement("mesh",null,r.createElement("planeBufferGeometry",{args:[m,f]}),r.createElement("meshBasicMaterial",{depthWrite:!1,map:e})))}function E(e,t,n){const a=r.useRef(t);r.useMemo((()=>{a.current=t}),[t]);const c=r.useRef(n);r.useMemo((()=>{c.current=n}),[n]),r.useEffect((()=>(window.addEventListener(e,a.current,c.current),()=>{window.removeEventListener(e,a.current,c.current)})),[e])}let k;!function(e){e[e.up=0]="up",e[e.down=1]="down",e[e.left=2]="left",e[e.right=3]="right"}(k||(k={}));var y=3,v=3;function b(){const e=function(){const[e,t]=r.useState([]);function n(e){let t;switch(e.toLocaleLowerCase()){case"w":case"arrowup":t=k.up;break;case"s":case"arrowdown":t=k.down;break;case"a":case"arrowleft":t=k.left;break;case"d":case"arrowright":t=k.right}return t}return E("keydown",(e=>{const r=n(e.key);void 0!==r&&t((e=>e.includes(r)?e:[...e,r]))})),E("keyup",(e=>{const r=n(e.key);void 0!==r&&t((e=>e.filter((e=>e!==r))))})),e}(),{canvas:t,ctx:n,texture:a}=r.useMemo((()=>{const e=document.createElement("canvas"),t=e.getContext("2d"),n=new o.Texture(e);return n.minFilter=o.NearestFilter,n.magFilter=o.NearestFilter,{canvas:e,ctx:t,texture:n}}),[]);return r.useEffect((()=>{const e=new Image;e.onload=()=>i(),e.src=h("/assets/player.png");let r,c=0,o=0,l=0;function i(){r=requestAnimationFrame(i);const s=e.width/4,m=e.height/4;t.width=s,t.height=m;const f=Date.now();if(!(f-l<125)){switch(l=f,p.direction){case u.none:o=0;break;case u.up:c=3;break;case u.down:c=0;break;case u.left:c=1;break;case u.right:c=2}n.clearRect(0,0,s,m),n.drawImage(e,s*o,m*c,s,m,0,0,s,m),++o>3&&(o=0),a.needsUpdate=!0}}return()=>cancelAnimationFrame(r)}),[t,n,a]),(0,l.x)((()=>{let t=0;for(let n=0,r=e.length;n<r;n++)switch(e[n]){case k.up:t=u.up;break;case k.down:t=u.down;break;case k.left:t=u.left;break;case k.right:t=u.right}switch(t){case u.none:p.velocity.set(0,0,0);break;case u.up:p.velocity.y=1;break;case u.down:p.velocity.y=-1;break;case u.left:p.velocity.x=-1;break;case u.right:p.velocity.x=1;break;default:p.velocity.set(0,0,0)}p.direction=t})),r.createElement("group",null,r.createElement("mesh",null,r.createElement("planeBufferGeometry",{args:[y,v]}),r.createElement("meshBasicMaterial",{depthWrite:!1,transparent:!0,map:a})))}var x=3,M=3;function z(){const e=r.createRef(),t=r.createRef(),{size:n,camera:a}=(0,l.w)();return r.useEffect((()=>{const t=e.current,n=a,r=o.MathUtils.degToRad(n.fov),c=2*Math.tan(r/2)*s.position.z,l=c*n.aspect;t.position.set(-.5*l+.5*x+.5,-.5*c+.5*M+.5,t.position.z)}),[n,a]),(0,l.x)((()=>{t.current.position.copy(p.position).multiplyScalar(x/m)})),r.createElement("group",{ref:e},r.createElement("mesh",null,r.createElement("planeBufferGeometry",{args:[x,M]}),r.createElement("meshBasicMaterial",{color:"black",depthWrite:!1})),r.createElement("mesh",{ref:t},r.createElement("planeBufferGeometry",{args:[y*(x/m),v*(M/f)]}),r.createElement("meshBasicMaterial",{color:"crimson",depthWrite:!1})))}function B(){return r.createElement(a.Xz,{flat:!0,linear:!0,dpr:1},r.createElement(r.Suspense,{fallback:r.createElement(c.x,null,"Loading...")},r.createElement(g,null),r.createElement(d,null,r.createElement(b,null),r.createElement(z,null))))}function F(){return r.createElement(r.Fragment,null,r.createElement(B,null))}}}]);
//# sourceMappingURL=828.ef970bf2.chunk.js.map